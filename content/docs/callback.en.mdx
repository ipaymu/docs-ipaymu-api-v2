---
title: Callback
description: Parameters and structure of the callback notification.
---

import { Tab, Tabs } from "fumadocs-ui/components/tabs";

# Callback

When a buyer completes a payment, iPaymu will send a callback notification to your configured endpoint. This document covers the complete callback structure, required headers, and signature validation process.

## Configuration

You can configure the callback content type in your iPaymu dashboard. Choose the format that works best for your system:

| Content-Type | Description |
|:-------------|:------------|
| `application/x-www-form-urlencoded` | Default. Recommended for better stability and compatibility |
| `application/json` | Alternative format if your system prefers JSON |

**Settings Links:**

- **Production:** [https://my.ipaymu.com/integration/setting](https://my.ipaymu.com/integration/setting)
- **Sandbox:** [https://sandbox.ipaymu.com/integration/setting](https://sandbox.ipaymu.com/integration/setting)

---

## Important Notes

Before implementing callback handling, make sure you understand these key points:

| Topic | Description |
|:------|:------------|
| **Retry Mechanism** | iPaymu will automatically retry the callback if your server doesn't respond with `200 OK`. Set up proper idempotency handling to avoid duplicate processing. |
| **Idempotency** | Since retries may occur, always check transaction status in your database before processing. This prevents double-posting when the same callback arrives multiple times. |
| **Signature Validation** | Always validate the `X-Signature` header to confirm the request genuinely comes from iPaymu. Never process callbacks without verification. |
| **Secret Key** | Use your **Merchant VA Number** as the secret key for signature validation. |

---

## Headers

Every callback request includes these headers. The `X-Signature` is crucial for security verification.

| Header | Value | Description |
|:-------|:------|:------------|
| `Accept` | `application/json` | The content type iPaymu expects for responses |
| `Content-Type` | `application/json` | Format of the request body |
| `X-External-ID` | `20251111101052209120` | Unique identifier for this callback request |
| `X-Signature` | `c9594cc8...` | HMAC-SHA256 signature for validation |
| `X-Timestamp` | `2025-11-11T10:10:52+07:00` | Timestamp when the callback was generated |

---

## Callback Data Structure

The following table shows all possible fields in a callback response. **Pay close attention to the data types** — using the wrong type during signature validation will cause hash mismatches.

### Core Transaction Fields

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `trx_id` | Integer | Unique transaction ID in iPaymu system | Convert from String if receiving via Form Data |
| `sid` | String | Transaction session ID | - |
| `reference_id` | String | Your merchant reference ID | - |
| `status` | String | Text status: `berhasil`, `pending`, `expired` | - |
| `status_code` | Integer | Status code: `1` (Success), `0` (Pending), `-2` (Expired) | Convert from String `"1"` to Integer `1` |

### Amount Fields

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `sub_total` | String | Net transaction amount | Leave as String |
| `total` | String | Gross transaction amount | Leave as String |
| `amount` | String | Total transaction amount | Leave as String |
| `fee` | String | Admin fee | Leave as String |
| `paid_off` | Integer | Net amount received (`amount - fee`) | Convert from String to Integer |

### Timestamp Fields

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `created_at` | String | Transaction creation time | Format: `YYYY-MM-DD HH:MM:SS` |
| `expired_at` | String | Transaction expiration time | - |
| `paid_at` | String | Payment completion time | - |
| `settlement_status` | String | Settlement status | `settled` or `unsettle` |

### Status Fields

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `transaction_status_code` | Integer | Original status code | Convert from String to Integer |
| `is_escrow` | Boolean | Escrow indicator | Convert String `"0"` to `false`, `"1"` to `true` |

### Payment Details

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `via` | String | Payment method (e.g., `va`) | - |
| `channel` | String | Payment channel (e.g., `bca`, `mandiri`) | - |
| `payment_no` | String | VA or payment number | **Important:** Keep as String to preserve leading zeros |
| `va` | String | Merchant VA number | Same as `payment_no`. Only present for VA transactions |
| `system_notes` | String | System-generated notes | - |

### Buyer Information

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `buyer_name` | String | Buyer name | - |
| `buyer_email` | String | Buyer email | - |
| `buyer_phone` | String | Buyer phone number | - |

### Additional Fields

| Field | Type | Description | Validation Notes |
|:------|:-----|:------------|:-----------------|
| `additional_info` | Array | Additional information | **Required:** Include `[]` even if field is not sent |
| `url` | String | Callback URL | - |

---

## Conditional Fields

Some fields behave differently depending on the payment method. Here's what to expect:

| Field | Behavior |
|:------|:---------|
| `transaction_status_code` | `1` = Payment settled immediately. `6` = Payment received (settlement may be processed separately) |
| `payment_no` | Populated for VA transactions. **Empty** for QRIS and e-wallet payments |
| `va` | Only present for VA transactions. **Not included** for QRIS and e-wallet payments |

---

## Signature Validation

To ensure callbacks genuinely come from iPaymu, you must validate the signature on every request. Here's the step-by-step process:

### Validation Steps

1. **Extract Data** — Get all data from `req.body`
2. **Normalize Types** — Convert values to their correct data types
   - String to Integer: `trx_id`, `status_code`, `transaction_status_code`, `paid_off`
   - String to Boolean: `is_escrow`
   - String `[]` to Array `[]`: `additional_info`
3. **Handle Missing Fields** — If `additional_info` is missing (common with `x-www-form-urlencoded`), add it manually as an empty array
4. **Sort Keys** — Sort all keys in **Ascending (A-Z)** order with case sensitivity
5. **Convert to JSON** — Serialize the sorted object to a JSON string
6. **URL Escape (Optional)** — Escape forward slashes (`/` → `\/`) if following strict PHP `json_encode` standards
7. **Generate Hash** — Create HMAC-SHA256 using the JSON string and your secret key (VA number)
8. **Compare** — Match your generated hash against the `X-Signature` header

### Example Code

<Tabs items={["x-www-form-urlencoded", "application/json"]}>
<Tab value="x-www-form-urlencoded">

```javascript
import crypto from 'crypto';
import express from 'express';

const app = express();

app.use(express.urlencoded({ extended: true }));

function normalizeData(rawData) {
    const result = {};
    for (const key in rawData) {
        let val = rawData[key];
        if (key === 'is_escrow') {
            result[key] = (val === 'true' || val === '1' || val === 1);
        }
        else if (['trx_id', 'status_code', 'transaction_status_code', 'paid_off'].includes(key)) {
            result[key] = parseInt(val, 10);
        }
        else if (key === 'additional_info') {
            if (val === '[]') result[key] = [];
            else result[key] = val;
        }
        else {
            result[key] = String(val);
        }
    }
    if (!result.hasOwnProperty('additional_info')) {
        result['additional_info'] = [];
    }
    return result;
}

function phpKsort(obj) {
    return Object.keys(obj)
        .sort((a, b) => a.localeCompare(b))
        .reduce((sortedObj, key) => {
            sortedObj[key] = obj[key];
            return sortedObj;
        }, {});
}

app.post('/callback', (req, res) => {
    const secretKey = '1179018174747171';
    const receivedSignature = req.headers['x-signature'];

    const normalizedData = normalizeData(req.body);
    if (normalizedData.signature) delete normalizedData.signature;

    const sortedData = phpKsort(normalizedData);
    let jsonBody = JSON.stringify(sortedData);
    jsonBody = jsonBody.replace(/\//g, '\\/');

    const calculatedSignature = crypto.createHmac('sha256', secretKey).update(jsonBody).digest('hex');

    if (calculatedSignature === receivedSignature) {
        console.log('Valid (URL Encoded)');
        res.status(200).json({ status: 'OK' });
    } else {
        console.log('Invalid (URL Encoded)');
        res.status(400).send('Invalid Signature');
    }
});

app.listen(3000, () => console.log('Server ready'));
```

</Tab>

<Tab value="application/json">

```javascript
import crypto from 'crypto';
import express from 'express';

const app = express();

app.use(express.json());

function phpKsort(obj) {
    return Object.keys(obj)
        .sort((a, b) => a.localeCompare(b))
        .reduce((sortedObj, key) => {
            sortedObj[key] = obj[key];
            return sortedObj;
        }, {});
}

app.post('/callback', (req, res) => {
    const secretKey = '1179018174747171';
    const receivedSignature = req.body.signature || req.headers['x-signature'];

    let data = { ...req.body };
    delete data.signature;

    const sortedData = phpKsort(data);
    let jsonBody = JSON.stringify(sortedData);
    jsonBody = jsonBody.replace(/\//g, '\\/');

    const calculatedSignature = crypto.createHmac('sha256', secretKey).update(jsonBody).digest('hex');

    if (calculatedSignature === receivedSignature) {
        console.log('Valid (JSON)');
        res.status(200).json({ status: 'OK' });
    } else {
        console.log('Invalid (JSON)');
        res.status(400).send('Invalid Signature');
    }
});

app.listen(3000, () => console.log('Server ready'));
```

</Tab>
</Tabs>

### Simple PHP Example

```php
$secretKey = '117000xxxxxx';
$input = file_get_contents('php://input');
$data  = json_decode($input, true) ?? $_POST;

$receivedSignature = $data['signature'] ?? '';
unset($data['signature']);

ksort($data);
$jsonBody = json_encode($data);
$calculatedSignature = hash_hmac('sha256', $jsonBody, $secretKey);

if (hash_equals($calculatedSignature, $receivedSignature)) {
    echo json_encode(['status' => 'success']);
} else {
    http_response_code(400);
}
```

---

**Source:** [iPaymu Callback Documentation](https://drive.google.com/file/d/1WfBEI5ry6V7knuSiCONYC4ZhQmD8Aipn/view)
